<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„é™æ€èµ„æºåº“</title>
    <style>
        :root { --primary: #006eff; --bg: #f7f8fa; --card: #fff; --text: #333; }
        body { font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* å¤´éƒ¨ */
        header { text-align: center; margin-bottom: 40px; padding-top: 20px; }
        h1 { margin: 0; color: var(--text); font-size: 2rem; }
        p.subtitle { color: #666; margin-top: 10px; }

        /* æœç´¢æ¡† */
        .search-wrapper { position: relative; margin-bottom: 30px; }
        input#search { width: 100%; padding: 15px 20px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; outline: none; box-sizing: border-box; transition: 0.3s; }
        input#search:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0,110,255,0.1); }

        /* å¡ç‰‡åˆ—è¡¨ */
        .lib-card { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .lib-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
        .lib-name { font-size: 1.4rem; font-weight: 700; color: var(--primary); }
        
        /* ç‰ˆæœ¬é€‰æ‹©å™¨ */
        select.ver-select { padding: 5px 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }

        /* æ–‡ä»¶åˆ—è¡¨ */
        .file-row { display: flex; align-items: center; background: #f9f9f9; padding: 10px; border-radius: 6px; margin-bottom: 8px; font-family: monospace; font-size: 0.9rem; }
        .file-path { flex-grow: 1; word-break: break-all; color: #555; margin-right: 10px; }
        
        /* æŒ‰é’® */
        .btn { border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 5px; transition: 0.2s; }
        .btn-copy-url { background: #e0e0e0; color: #333; }
        .btn-copy-tag { background: var(--primary); color: white; }
        .btn:hover { opacity: 0.8; }
        
        /* æç¤º */
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 50px; opacity: 0; transition: 0.3s; pointer-events: none; }
        #toast.show { opacity: 1; bottom: 40px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ“¦ Static Libs</h1>
        <p class="subtitle">å†å²ç‰ˆæœ¬æ°¸ä¹…å­˜æ¡£ Â· è‡ªåŠ¨åŒæ­¥ GitHub</p>
    </header>

    <div class="search-wrapper">
        <input type="text" id="search" placeholder="æœç´¢åº“å (å¦‚ jquery, vue)...">
    </div>

    <div id="app">
        <div style="text-align: center; color: #999;">æ­£åœ¨è¯»å– catalog.json...</div>
    </div>
</div>

<div id="toast">å·²å¤åˆ¶!</div>

<script>
    let catalog = [];
    const app = document.getElementById('app');
    const toast = document.getElementById('toast');

    // 1. è·å–è´¦æœ¬æ•°æ®
    fetch('./catalog.json')
        .then(res => res.json())
        .then(data => {
            catalog = data;
            render(catalog);
        })
        .catch(err => {
            app.innerHTML = '<div style="text-align:center;color:red">æ— æ³•è¯»å–èµ„æºåˆ—è¡¨ï¼Œè¯·ç¡®ä¿ GitHub Action å·²è¿è¡ŒæˆåŠŸã€‚</div>';
        });

    // 2. æ¸²æŸ“å‡½æ•°
    function render(list) {
        if(list.length === 0) {
            app.innerHTML = '<div style="text-align:center;color:#999">æœªæ‰¾åˆ°åŒ¹é…çš„åº“</div>';
            return;
        }
        
        app.innerHTML = list.map((lib, index) => {
            // é»˜è®¤æ˜¾ç¤ºæœ€æ–°çš„ç‰ˆæœ¬
            const latestVer = lib.versions[0]; 
            // ç”Ÿæˆç‰ˆæœ¬ä¸‹æ‹‰æ¡†é€‰é¡¹
            const options = lib.versions.map((v, i) => `<option value="${i}">${v.version}</option>`).join('');
            
            return `
            <div class="lib-card" id="card-${index}">
                <div class="lib-header">
                    <span class="lib-name">${lib.name}</span>
                    <select class="ver-select" onchange="changeVersion(${index}, this.value)">
                        ${options}
                    </select>
                </div>
                <div class="file-list" id="files-${index}">
                    ${renderFiles(latestVer.files)}
                </div>
            </div>`;
        }).join('');
    }

    // 3. æ¸²æŸ“å…·ä½“ç‰ˆæœ¬çš„æ–‡ä»¶åˆ—è¡¨
    function renderFiles(files) {
        return files.map(file => {
            const fullUrl = window.location.origin + file;
            let tag = fullUrl;
            if(file.endsWith('.js')) tag = `<script src="${fullUrl}"><\/script>`;
            if(file.endsWith('.css')) tag = `<link rel="stylesheet" href="${fullUrl}">`;

            return `
            <div class="file-row">
                <span class="file-path">${file}</span>
                <button class="btn btn-copy-url" onclick="copy('${fullUrl}')">å¤åˆ¶é“¾æ¥</button>
                <button class="btn btn-copy-tag" onclick="copy('${tag}')">å¤åˆ¶æ ‡ç­¾</button>
            </div>`;
        }).join('');
    }

    // 4. åˆ‡æ¢ç‰ˆæœ¬
    window.changeVersion = (cardIndex, verIndex) => {
        const lib = catalog[cardIndex]; // æ³¨æ„è¿™é‡Œè¦ç”¨å½“å‰è¿‡æ»¤åçš„ list è¿˜æ˜¯å…¨å±€ catalogï¼Œç®€å•èµ·è§å‡è®¾æœªè¿‡æ»¤
        // é‡æ–°æŸ¥æ‰¾å½“å‰æ˜¾ç¤ºçš„æ˜¯å“ªä¸ªåº“ï¼ˆå¤„ç†æœç´¢åçš„ç´¢å¼•é—®é¢˜ï¼‰
        // å®é™…ä¸Šä¸ºäº†ç®€å•ï¼Œæœç´¢æ—¶ä¼šé‡ç»˜æ‰€æœ‰å¡ç‰‡ï¼Œæ‰€ä»¥ä¸‹é¢é‡å†™é€»è¾‘
    };

    // ä¿®æ­£ï¼šåˆ‡æ¢ç‰ˆæœ¬é€»è¾‘ï¼ˆé…åˆæœç´¢ï¼‰
    window.changeVersion = (cardIndex, verIndex) => {
        // ç”±äº innerHTML é‡æ–°æ¸²æŸ“ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°è·å–æ•°æ®æº
        // è¿™é‡Œåšä¸€ä¸ªç®€å•çš„ DOM æ“ä½œï¼Œä¸é‡æ–°æ¸²æŸ“æ•´ä¸ªåˆ—è¡¨
        const card = document.getElementById(`card-${cardIndex}`);
        const libName = card.querySelector('.lib-name').innerText;
        const libData = catalog.find(l => l.name === libName);
        const selectedVer = libData.versions[verIndex];
        
        const fileListDiv = document.getElementById(`files-${cardIndex}`);
        fileListDiv.innerHTML = renderFiles(selectedVer.files);
    }

    // 5. æœç´¢åŠŸèƒ½
    document.getElementById('search').addEventListener('input', (e) => {
        const key = e.target.value.toLowerCase();
        const filtered = catalog.filter(lib => lib.name.toLowerCase().includes(key));
        
        // é‡æ–°æ¸²æŸ“ï¼Œæ³¨æ„è¿™é‡Œçš„ index ä¼šé‡ç½®ï¼Œæ‰€ä»¥ changeVersion çš„é€»è¾‘è¦é€‚é…
        // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬åœ¨ render æ—¶é‡æ–°ç”Ÿæˆ HTML
        render(filtered);
    });

    // 6. å¤åˆ¶åŠŸèƒ½
    window.copy = (text) => {
        navigator.clipboard.writeText(text).then(() => {
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        });
    }
</script>
</body>
</html>
